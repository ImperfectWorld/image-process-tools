/** 
 * image-process 
 * version: 2.2.3 
 * author: zx1984 
 * https://github.com/zx1984 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.IPTS=t():e.IPTS=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";var n={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/jaeg",gif:"image/png",bmp:"image/jpeg"},o="选中的文件非图片文件，返回选中文件数据data",s={1:"配置参数未配置或有误",2:"请配置图片选择按钮#id或.class",3:"浏览器不支持addEventListener()",4:"浏览器不支持FileReader接口！\n需升级或更换高版本的浏览器",5:"未选中文件",6:"选中的文件不是图片文件",7:"文件读取错误",8:"图片数据加载错误",9:"当前图片文件尺寸小于裁剪尺寸"};function i(e){var t=this._checkParameter(e);t?e.error&&e.error(t):(this.btn=c(e.elm),this.fileInput=null,this.opts=e,this.init())}var a=i.prototype;function c(e){return document.querySelector(e)||null}function p(e){var t=parseInt(e);return isNaN(t)?0:t}function u(e,t){return parseInt(e/t*1e4)/1e4}function l(e,t){var r=document.createElement("canvas");return r.width=t.cw,r.height=t.ch,r.getContext("2d").drawImage(e,t.sx,t.sy,t.sw,t.sh,0,0,r.width,r.height),r}a._checkParameter=function(e){return!e instanceof Object?{code:1,msg:s[1]}:e.elm&&c(e.elm)?void 0:{code:2,msg:s[2]}},a.createFIleInput=function(){var e=document.createElement("input");e.setAttribute("type","file"),e.style.display="none",e.id="IPTS_"+(new Date).getTime(),this.btn.parentNode.appendChild(e),this.fileInput=e},a.triggerFileInput=function(){var e=this;this.btn.addEventListener?this.btn.addEventListener("click",function(t){var r=new MouseEvent("click",{bubbles:!1,cancelable:!0,view:window});e.fileInput.dispatchEvent(r)},!1):this.opts.error&&this.opts.error({code:3,msg:s[3]})},a.getFileData=function(e){var t=this;"undefined"!=typeof FileReader?this.fileInput.addEventListener("change",function(r){var n=this.files[0];if(n){if(!function(e){var t=(r=e,r.toString().split(".").pop().toLowerCase());var r;/(\w+)\?/.test(t)&&(t=RegExp.$1);return["png","jpg","jpeg","gif","webp","bmp"].indexOf(t)>-1}(n.name))return t.opts.success&&t.opts.success({code:1,msg:o,data:n}),void(t.opts.error&&t.opts.error({code:6,msg:s[6]}));var i=new FileReader;i.readAsDataURL(n),i.onload=function(r){var o,i,a;o=this.result,i=n,(a=new Image).src=o,a.setAttribute("alt",i.name),a.onload=function(t){e&&e({element:a,data:o,width:a.width,height:a.height,type:i.type,size:i.size})},a.onerror=function(e){t.opts.error&&t.opts.error({code:8,msg:s[8]})}},i.onerror=function(e){t.opts.error&&t.opts.error({code:7,msg:s[7]})}}else t.opts.error&&t.opts.error({code:5,msg:s[5]})},!1):this.opts.error&&this.opts.error({code:4,msg:s[4]})},a.handleImageData=function(e,t){var r=this.opts,o=r.type?r.type.toLowerCase():null,s=o&&n[o]?n[o]:e.type;r.progress&&r.progress(0);var i=this.calculateCropInfo(e.width,e.height),a=e.element,c=2,p=i.sw,u=i.sh,d=i.sx,h=i.sy;if(i.scaling>c){c=i.scaling;do{r.progress&&r.progress(2/c),p=(a=l(a,{cw:i.cw*c,ch:i.ch*c,sx:d,sy:h,sw:p,sh:u})).width,u=a.height,d=h=0,c-=1}while(c>2)}var f=(a=l(a,{cw:i.cw,ch:i.ch,sx:d,sy:h,sw:p,sh:u})).toDataURL(s),g=function(e,t){var r=function(e){var t=e.split(","),r="";/data:(\w+\/\w+);base64/.test(t[0])&&(r=RegExp.$1);return{type:r,data:t[1]}}(e);e=window.atob(r.data),t=t||r.type;for(var n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return new Blob([n],{type:t})}(f,s);r.progress&&r.progress(1),t&&t({code:0,msg:"Completed",element:a,type:s,width:i.cw,height:i.ch,data:g,base64:f,size:g.size,rawdata:e})},a.calculateCropInfo=function(e,t){var r=this.opts,n="boolean"==typeof r.crop&&r.crop,o=p(r.width),i=p(r.height);(e<o||t<i)&&r.error&&r.error({code:9,msg:s[9]});var a=1,c=0,l=0,d=e,h=t,f=0;return n&&o>0&&i>0?(d=o,h=i,o,f=Math.floor(o*t/e),a=u(e,o),f>=i?(c=0,l=p((f-i)/2*a)):(a=u(t,i),f=i,c=p((Math.floor(i*e/t)-o)/2*a),l=0)):o>0?(a=u(e,o),d=o,h=Math.floor(o*t/e)):i>0&&(a=u(t,i),d=Math.floor(i*e/t),h=i),{sx:c,sy:l,sw:p(d*a),sh:p(h*a),scaling:a,cw:d,ch:h}},a.conversion=function(e){var t=p(p(e)/1024*100)/100;return t>=1024?p(t/1024*100)/100+"M":t+"KB"},a.init=function(){var e=this;this.createFIleInput(),this.triggerFileInput(),this.getFileData(function(t){e.handleImageData(t,function(t){var r=c(e.opts.target);r&&(r.innerHTML="",r.appendChild(t.element)),e.opts.success&&e.opts.success(t)})})},e.exports=i}])});